---
import IconButton from './IconButton.astro'
---

<theme-toggle>
  <IconButton id="light-theme" name="heroicons-solid:sun" label="Switch to light theme" lg />
  <IconButton id="dark-theme" name="heroicons-solid:moon" label="Switch to dark theme" lg />
</theme-toggle>

<style is:global>
  :root:not([data-theme]) theme-toggle {
    display: none;
  }

  :root[data-theme='light'] #light-theme {
    display: none;
  }

  :root[data-theme='dark'] #dark-theme {
    display: none;
  }
</style>

<script>
  class ThemeToggle extends HTMLElement {
    #onClick = this.toggleTheme.bind(this)

    connectedCallback() {
      if (this.button) {
        this.button.addEventListener('click', this.#onClick, true)
      }
    }

    disconnectedCallback() {
      if (this.button) {
        this.button.removeEventListener('click', this.#onClick)
      }
    }

    get button() {
      return this.querySelector<HTMLButtonElement>('button')
    }

    toggleTheme() {
      this.setTheme(document.documentElement.dataset.theme === 'dark' ? 'light' : 'dark')
    }

    setTheme(theme: 'dark' | 'light') {
      document.documentElement.dataset.theme = theme
      localStorage.theme = theme
    }
  }

  customElements.define('theme-toggle', ThemeToggle)
</script>
